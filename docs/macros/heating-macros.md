# Отопление

- [Отопление](#отопление)
  - [Базис](#базис)
    - [Тепло-генератор](#тепло-генератор)
      - [Электричество -\> воздух](#электричество---воздух)
      - [Электричество -\> вода -\> воздух](#электричество---вода---воздух)
      - [Твердое топливо -\> вода -\> воздух](#твердое-топливо---вода---воздух)
      - [Жидкое топливо -\> вода -\> воздух](#жидкое-топливо---вода---воздух)
      - [Электричество + (тепло/холод от воздуха, земли, воды) -\> вода -\> воздух](#электричество--теплохолод-от-воздуха-земли-воды---вода---воздух)
      - [Управление тепло-генератором](#управление-тепло-генератором)
    - [Циркуляционный насос](#циркуляционный-насос)
      - [Управление циркуляционным насосом](#управление-циркуляционным-насосом)
    - [Прямой или смесительный контур](#прямой-или-смесительный-контур)
      - [Управление контуром](#управление-контуром)
    - [Отопительный прибор](#отопительный-прибор)
      - [Управление отопительным прибором](#управление-отопительным-прибором)
    - [Подпитка](#подпитка)
  - [Автоматизация](#автоматизация)
    - [Обзор](#обзор)
    - ["Термостат" или запрос тепла](#термостат-или-запрос-тепла)
      - [Входящие аргументы](#входящие-аргументы)
      - [Логика работы](#логика-работы)
        - [Возможно ли тут применить ПИД регулирование ?](#возможно-ли-тут-применить-пид-регулирование-)
      - [Исходящие аргументы](#исходящие-аргументы)
    - [Смеситель](#смеситель)
      - [Входящие аргументы](#входящие-аргументы-1)
      - [Логика работы](#логика-работы-1)
        - [Вычисление ошибки и управляющего сигнала](#вычисление-ошибки-и-управляющего-сигнала)
          - [Пропорциональный компонент](#пропорциональный-компонент)
          - [Интегральный компонент](#интегральный-компонент)
          - [Дифференциальный компонент](#дифференциальный-компонент)
        - [Линейная связь управляющего сигнала и поворота крана](#линейная-связь-управляющего-сигнала-и-поворота-крана)
      - [Исходящие аргументы](#исходящие-аргументы-1)
    - [Транспортировка тепла](#транспортировка-тепла)
      - [Входящие аргументы](#входящие-аргументы-2)
      - [Логика работы](#логика-работы-2)
      - [Исходящие аргументы](#исходящие-аргументы-2)
    - [Генерация тепла](#генерация-тепла)
      - [Входящие аргументы](#входящие-аргументы-3)
      - [Логика работы](#логика-работы-3)
      - [Исходящие аргументы](#исходящие-аргументы-3)
    - [Подпитка](#подпитка-1)
      - [Входящие аргументы](#входящие-аргументы-4)
      - [Логика работы](#логика-работы-4)
      - [Исходящие аргументы](#исходящие-аргументы-4)

## Базис

### Тепло-генератор

#### Электричество -> воздух

Рассматриваются устройства, без наличии автоматики на борту.

- Различные виды конвекторов
- Различные виды калориферов
- Различные виды инфракрасных обогревателей

#### Электричество -> вода -> воздух

Рассматриваются устройства с наличием автоматики на борту.

- Электрический котел

#### Твердое топливо -> вода -> воздух

Рассматриваются устройства с наличием автоматики на борту.

- Твердотопливный котел (дрова)
- Твердотопливный котел (уголь)
- Твердотопливный котел (пилеты)

#### Жидкое топливо -> вода -> воздух

Рассматриваются устройства с наличием автоматики на борту.

- Газовый котел
- Дизельный котел

#### Электричество + (тепло/холод от воздуха, земли, воды) -> вода -> воздух

Рассматриваются устройства с наличием автоматики на борту.

- Воздушный тепловой насос
- Грунтовый тепловой насос (вода-вода, земля-земля)
- Солнечный коллектор

#### Управление тепло-генератором

- Релейное, через вкл/выкл питания
- Релейное, через замыкания клеммы термостата
- Электронное, через установку требуемой температуры подачи
- Комбинированный релейное через замыкание клеммы термостата + установки требуемой температуры подачи
- Каскадное, включение котлов по в заданном порядке, в зависимости от температуры обратки (если температура ниже расчетной то запускается второй котел и так далее). В этом методе управления, могут выступать дополнительные косвенные факторы (температура на улице, температура в помещениях, температура (подачи, обратки, расход теплоносителя) и количество активированных котлов, импульсный счетчик тепла )
- Резервирование, включение в замен основного котла/котлов резервного, при достижении определенных условий, релейным и/или электронным способом.

### Циркуляционный насос

Входит в состав прямого или смесительного контура.

Входит в состав электрического котла, возможно сторонне управление насосом электрического котла если невозможно использовать релейно-электронный способ.

Входит в состав схемы управления твердотопливным котлом, так же в схему работы твердотопливного котла входит тепло-аккумулятор от 1000 литров, так как в 1000 литрах, между 40 и 80 градусов, всего 40 кВт. А если дом тратит 6 кВт/час, то аккумулятор проработает 6.66 часа, до следующей зарядки, в целом не плохо для пилетного котла, и не очень удобно для угольно дровяного котла, и по этому лучше подбирать котел с минимальной мощностью 3 и ниже кВт, чтобы не ставить тепло аккумулятор. Чтобы за час зарядить 1000 литров, нужен котел с макс мощностью 46 кВт/час. Но выгодно ставить котел [8-31 кВт](http://biodomrussia.com/biodom27c5/) и загружать аккумулятор медленнее, тем самым растягивая такты работы котла в оптимальном режиме.

#### Управление циркуляционным насосом

- Релейное, через вкл/выкл питания, тут тоже может быть переменный расход, но насос терпит работу на закрытую задвижку, так как мощность насоса маленькая.
- Частотный преобразователь, только для больших насосов, с переменным расходом.

### Прямой или смесительный контур

- Группа радиаторов (смесительный)
- Группа труб теплого пола (смесительный)
- Бойлер косвенного нагрева (прямой)
- Калорифер вентиляции (смесительный)
- Бассейн (прямой со стороны котла) + (прямой со стороны бассейна)
- Тепловой аккумулятор (прямой)
- Солнечный аккумулятор (прямой со стороны котла) + (прямой со стороны солнечного коллектора)
- И так далее ...

#### Управление контуром

- Аналоговое, через подачу от 0 до 10 вольт на устройство, что соответствует проценту между крайними положениями.
- Механическое, через трехходовой термостатический клапан.
- Механическое, через фиксированное положение трехходового крана.

### Отопительный прибор

- Один радиатор (управление на радиаторе или на коллекторе)
- Одна труба теплого пола или стены (управление на коллекторе)
- Одна труба снеготаяния (управление на коллекторе)
- Фанкойл (тепловая завеса, калорифер с вентилятором)
- Водяной конвектор встроенный п вол с вентилятором или без
- И так далее ...

#### Управление отопительным прибором

- Механическое, через фиксированное положение крана
- Электромеханическое, через термостатический сервопривод
- Аналоговое, через подачу от 0 до 10 вольт на сервопривод (термостатический или другого исполнения), что соответствует проценту между крайними положениями
- Релейное, через подачу питания (на вентилятор, клемму термостата)

### Подпитка

Система отслеживающая давление в системе отопления для:

- Уведомлении о падении давления
- Подпитка в автоматическом режиме
- Мониторинг за давлением

## Автоматизация

### Обзор

В системах отопления как правило присутствуют действующие акторы в виде приборов запрашивающих тепло, генерирующих тепло и доставляющих тепло в нужном объеме.

В совсем простых системах, могут присутствовать только запрашивающие и генерирующие тепло устройства, и как правило это системы где тепло передается в виде электричества.

Запрашивают тепло как правило приборы, потребляющие тепло для каких либо нужд, нагрев воздуха по средством радиаторов, нагрев поверхностей за счет труб (теплого пола, снеготаяния), приготовление горячей воды, нагрев бассейна, подогрев воздуха в вентиляционной установке.

В системах где тепло передается не по средством электричества, применяется некая среда (гликоль, вода, другие жидкости) которая перемещает тепло из одного места в другое, и устройства помогающие перемещать саму среду (насосы), а так же присутствуют устройства, которые дозируют потребление тепла (смесительные узлы) которые ограничивают передачу тепла от генератора к каждому потребителю путем подмешивания более горячего носителя в контур с остывшим носителем.

Производят тепло, устройства генерации тепла, они бывают разных видом и устройств, но единственная их задача это нагревать среду которая постоянно перемещается по средством насосов по всей сети отопления.

### "Термостат" или запрос тепла

С точки зрения автоматики, "термостат" или запрос тепла состоит из:

#### Входящие аргументы

- Тип нагреваемой среды
  - Вода в бойлере
  - Воздуха в доме
  - Поверхность пола
  - Поверхность стены
  - Поверхность дорожки на улице
  - Воды в бассейне
  - Помогает выбрать min/max температуру на подающей линии
  - Если выбрана нагреваемая среда, то при редактировании min/max температуры будет появляться окно подтверждения с предупреждением
- Минимальная значение запроса на температуру подающей линии
  - Для теплого пола 30
  - Для радиатора 30
  - Для дорожки на улице 55
  - Для бойлера 60
  - Ниже это температуры нельзя будет запросить
  - Безусловный нижний предел это 10
- Максимальное значение запроса на температуру подающей линии
  - Для теплого пола 50
  - Для радиатора 75
  - Для снеготаяния 75
  - Для бойлера 75
  - Выше этой температуры будет невозможно запросить
  - Без условный верхний предел 75

- Минимальный запрос температуры подачи, между min и max значением, по умолчанию 25%
  - Можно задать в диапазоне от 100% до 25%
  - При значении 100%, ограничение по температуре отключается, и запрос температуры подающей линии всегда имеет максимальное значение
- Минимальный расход в приборе, по умолчанию 25%
  - Можно задать в диапазоне от 100% до 25%
  - При значении 100%, ограничение по расходу отключается, и расход всегда 100%

- Уставка/Требуемая/Целевая температура нагреваемой среды
  - Воды в бойлере
  - Воздуха в доме
  - Поверхность пола
  - Поверхность стены
  - Поверхность дорожки на улице
  - Воды в бассейне
  - И других сред которые можно нагревать до желаемой пользователем температуры
  - При достижении уставки, начинается пропорциональное уменьшение температуры подающей линии и расхода

- Левая часть гистерезиса
  - Не более -20 единиц, от уставки
  - Значение после которого включается запрос тепла
- Правая часть гистерезиса
  - Не более +10 единиц, от уставки
  - Значение после которого выключается запрос тепла

- Датчики температуры нагреваемой среды
  - Тип контрола value
  - В реальности это либо проводной, либо без проводной датчик температуры
- Правила для вычисления температуры нагреваемой среды
  - MAX максимальную, MIN минимальную, AVG среднюю, по умолчанию AVG

- Наличие расхода
  - Тип контрола switch
  - Ожидает на входе положение реле которые подают питание на насосы
  - Если все реле **ВЫКлючены**, то все приводы петель, переводятся в нормальное положение

#### Логика работы

Расстояние между min и max значением запроса тепла, это 100%

Если значение ниже левого гистерезиса, то выставляется 100% запроса тепла

Если достигнута температура после которой температура пропорционально снижается, то запрос тепла уменьшается в процентах

Если достигнута температура правого гистерезиса, запрос тепла становится 0%, нагрев заканчивается

##### Возможно ли тут применить ПИД регулирование ?

Если генератор тепла способен плавно регулировать свою мощность от 0 до 100% своих характеристик, то в таком случае возможно применить ПИД регулирование.

Если установлена буферная емкость мощностью в 5-10 раз больше минимальной мощности потери тепла, то в таком случае возможно применить ПИД регулирование.

Если минимальные потери тепла выше минимальной регулировки генератора тепла, то в таком случае возможно применить ПИД регулирование.

В остальных случаях удобно использовать управление по схеме термостата с гистерезисом, так как инертную систему удобно использовать как тепло аккумулятор, чтобы избегать тактования генератора тепла.

#### Исходящие аргументы

- "Термостат включен" или запрос тепла, логическое значение, которое принимает два состояния, правда или лож, что интерпретируется как греть или не греть
  - Подставляется в макрос генератор тепла
  - Подставляется в макрос управления насосами соответствующих прямых и/или смесительных групп

- Температура подающей линии, числовое значение в градусах цельсия
  - Подставляется в макрос генератор тепла
  - Подставляется в макрос смесители соответствующих прямых и/или смесительных групп

- Расход теплоносителя, числовое значение от 0 до 100%
  - Подставляется в макрос управляющий соответствующими сервоприводами

### Смеситель

С точки зрения автоматики, смеситель состоит из:

#### Входящие аргументы

- Текущая температура подачи (tCurrent)
  - Берется из датчика температуры установленного после смесителя и насоса на подающей линии
- Требуемые/Уставки температуры подачи (temperature)
  - Берутся из "Термостатов"/Запросов тепла
  - Правило выбора температуры из преложенных вариантов
    - MAX максимальную
    - MIN минимальную
    - AVG среднюю
    - По умолчанию MAX
- Минимальная значение температуры подачи (tMin)
  - По умолчанию 40
  - Устанавливается при пуска-наладке
- Максимальное значение температуры подачи (tMax)
  - По умолчанию 45
  - Устанавливается при пуска-наладке
- Такты вычислениями ошибки в микро секундах
  - По умолчанию 30 * 1000 ms
  - Устанавливается при пуска-наладке
- Коэффициент пропорционального регулирования (kP)
  - По умолчанию 1
  - Подбирается при пуска-наладке
- Коэффициент интегрального регулирования (kI)
  - По умолчанию 0.25
  - Подбирается при пуска-наладке
- Коэффициент дифференциального регулирования (kD)
  - По умолчанию 0.5
  - Подбирается при пуска-наладке
- Минимальная значение ошибки (eMin)
  - По умолчанию 0
  - Устанавливается по проекту
- Максимальное значение ошибки (eMax)
  - По умолчанию (Минимальная значение температуры подачи - Минимальная значение температуры подачи)
  - Устанавливается по проекту
- Минимальный физический управляющий сигнал (oMin)
  - По умолчанию 0
  - Значение зависит от фактически используемых устройств, или говоря абстрактно, от потребителя этого параметра.
- Максимальное физический управляющий сигнал (oMax)
  - По умолчанию 10000
  - Значение зависит от фактически используемых устройств, или говоря абстрактно, от потребителя этого параметра.

#### Логика работы

Общий смысл регулирования достаточной простой и заключается в:
  1. Вычислении ошибки
  2. Вычислении величины управляющего сигнала, по формуле ПИД регулирования
  3. Связи управляющего сигнал со значением физической величины
  4. Передача полученной физической величины исполнительному устройству
  5. Устройство меняет физическое поведение системы
  6. Происходит ожидание следующего такта, в это время меняются параметры инертной физической среды
  7. Наступает следующий такт, и все начинается с пункта 1

##### Вычисление ошибки и управляющего сигнала

Ошибка это разница между уставкой и измеренным значением.

Управляющий сигнал вычисляется по средством сложения трех составляющих пропорциональной, интегральной, дифференциальной.

Настройка влияния того или иного фактора происходит через коэффициенты, чем он коэффициент больше чем влияние сильнее.

###### Пропорциональный компонент

Это значение ошибки умноженное на коэффициент пропорционального регулирования.

###### Интегральный компонент

Это сумма значений ошибки за все предыдущие такты умноженная на коэффициент интегрального регулирования.

Позволяет обострить небольшую ошибку, чтобы достичь точного значения в нашем случае температуры.

Либо ускорить регулирование, если величина ошибки большая.

Нужно быть внимательным, и если регулировка ушла в крайнее значение, переставать суммировать в интегральной составляющей, так как если значение ошибки перевернется в другую сторону то придется долго ждать пока не проссумируется отрицательная (или положительная) ошибка, явление известное как интегральный "перегон".

###### Дифференциальный компонент

Это разница между текущем значением ошибки и значением ошибки на прошлом такте, деленная на продолжительность такта.

Показывает скорость изменения ошибки.

##### Линейная связь управляющего сигнала и поворота крана

Для связи управляющего сигнала и физического сигнала, используется формула где:

eMin - Минимальное значение ошибки

eMax - Максимальное значение ошибки

oMin - 0 - Минимальный физический управляющий сигнал

oMax - 10000 - Максимальный физический управляющий сигнал

oMin и oMax - конкретное значение на текущем оборудовании, в идеале должно вводиться через настройки.

error - это результат который возвращает ПИД регулятор.

Формула в общем виде: oMin + ((error - eMin)/(eMax - eMin)) * (oMax - oMin).

Если oMin = 0, формула сокращается до: oMax * ((error - eMin)/(eMax - eMin)).

В случае если oMin и oMax вводятся в настройках, нужно использовать общий вид формулы.

Пример, уставка 40, температура подачи 43, eMin = 0, eMax = 5. oMin = 0, oMax = 10000, физический сингал = 10000 ((3 - 0) / (5 - 0)) = 10000 * (3 / 5) = 6000 (в нашем случае, кран прикроется на 60%, от 0% положения).

Пример, уставка 40, температура подачи 38, eMin = 0, eMax = 5. oMin = 0, oMax = 10000, физический сингал = 10000 ((-2 - 0) / (5 - 0)) = 10000 * (-2 / 5) = -4000 (в нашем случае, кран прикроется до положения 0%, из того положения в котором он был ранее).

Таким образом, можно связывать любые величины с ошибкой линейным способом.

#### Исходящие аргументы

- Положение смесительного крана (0-10 Вольт, что в реальности числовые значения от 0 до 10000)
  - Эти значения зависят от используемого оборудования.

### Транспортировка тепла

С точки зрения автоматики, транспортировка тепла состоит из:

#### Входящие аргументы

- Запросы на перемещение тепла, может принимать не ограниченное кол-во запросов тепла.

#### Логика работы

При появлении запроса на перемещение тепла активируется питание насоса по средством реле, и насос начинает качать.

#### Исходящие аргументы

- Включение реле, которое питает насос.

### Генерация тепла

С точки зрения автоматики, генерация тепла состоит из:

#### Входящие аргументы

#### Логика работы

#### Исходящие аргументы

### Подпитка

С точки зрения автоматики, подпитка состоит из:

#### Входящие аргументы

#### Логика работы

#### Исходящие аргументы
