# Отопление

- [Отопление](#отопление)
  - [Обзор](#обзор)
    - [Тепло-генератор](#тепло-генератор)
      - [Электричество -\> воздух](#электричество---воздух)
      - [Электричество -\> вода -\> воздух](#электричество---вода---воздух)
      - [Твердое топливо -\> вода -\> воздух](#твердое-топливо---вода---воздух)
      - [Жидкое топливо -\> вода -\> воздух](#жидкое-топливо---вода---воздух)
      - [Электричество + (тепло/холод от воздуха, земли, воды, тепло от солнца) -\> вода -\> воздух](#электричество--теплохолод-от-воздуха-земли-воды-тепло-от-солнца---вода---воздух)
      - [Управление тепло-генератором](#управление-тепло-генератором)
    - [Циркуляционный насос](#циркуляционный-насос)
      - [Управление циркуляционным насосом](#управление-циркуляционным-насосом)
    - [Прямой или смесительный контур](#прямой-или-смесительный-контур)
      - [Управление контуром](#управление-контуром)
    - [Отопительный прибор](#отопительный-прибор)
      - [Управление отопительным прибором](#управление-отопительным-прибором)
    - [Подпитка](#подпитка)
  - [Автоматизация](#автоматизация)
    - [Обзор](#обзор-1)
    - [Термостат](#термостат)
      - [Входящие аргументы](#входящие-аргументы)
      - [Логика работы](#логика-работы)
        - [Нагрев](#нагрев)
          - [Возможно ли тут применить ПИД регулирование ?](#возможно-ли-тут-применить-пид-регулирование-)
          - [Вариант ПИД регулирования](#вариант-пид-регулирования)
        - [Охлаждение](#охлаждение)
      - [Исходящие аргументы](#исходящие-аргументы)
    - [Термостатические сервоприводы](#термостатические-сервоприводы)
      - [Входящие аргументы](#входящие-аргументы-1)
      - [Логика работы](#логика-работы-1)
      - [Исходящие аргументы](#исходящие-аргументы-1)
    - [Смеситель](#смеситель)
      - [Входящие аргументы](#входящие-аргументы-2)
      - [Логика работы](#логика-работы-2)
        - [Вычисление ошибки и управляющего сигнала](#вычисление-ошибки-и-управляющего-сигнала)
          - [Пропорциональный компонент](#пропорциональный-компонент)
          - [Интегральный компонент](#интегральный-компонент)
          - [Дифференциальный компонент](#дифференциальный-компонент)
        - [Линейная связь управляющего сигнала и поворота крана](#линейная-связь-управляющего-сигнала-и-поворота-крана)
      - [Исходящие аргументы](#исходящие-аргументы-2)
    - [Транспортировка теплоносителя](#транспортировка-теплоносителя)
      - [Входящие аргументы](#входящие-аргументы-3)
      - [Логика работы](#логика-работы-3)
      - [Исходящие аргументы](#исходящие-аргументы-3)
    - [Генерация тепла](#генерация-тепла)
      - [Входящие аргументы](#входящие-аргументы-4)
      - [Логика работы](#логика-работы-4)
      - [Исходящие аргументы](#исходящие-аргументы-4)
    - [Подпитка](#подпитка-1)
      - [Входящие аргументы](#входящие-аргументы-5)
      - [Логика работы](#логика-работы-5)
      - [Исходящие аргументы](#исходящие-аргументы-5)

## Обзор

### Тепло-генератор

Процесс нагрева обозначается стрелкой "->".

#### Электричество -> воздух

Рассматриваются устройства, без наличии автоматики на борту.

- Различные виды конвекторов
- Различные виды калориферов
- Различные виды инфракрасных обогревателей

#### Электричество -> вода -> воздух

Рассматриваются устройства с наличием автоматики на борту.

- Электрический котел

#### Твердое топливо -> вода -> воздух

Рассматриваются устройства с наличием автоматики на борту.

- Твердотопливный котел (дрова)
- Твердотопливный котел (уголь)
- Твердотопливный котел (пилеты)

#### Жидкое топливо -> вода -> воздух

Рассматриваются устройства с наличием автоматики на борту.

- Газовый котел
- Дизельный котел

#### Электричество + (тепло/холод от воздуха, земли, воды, тепло от солнца) -> вода -> воздух

Рассматриваются устройства с наличием автоматики на борту.

- Воздушный тепловой насос
- Грунтовый тепловой насос (вода-вода, земля-земля)
- Солнечный коллектор

#### Управление тепло-генератором

- Релейное, через вкл/выкл питания
- Релейное, через замыкания клеммы термостата
- Электронное, через установку требуемой температуры подачи
- Комбинированный релейное через замыкание клеммы термостата + установки требуемой температуры подачи
- Каскадное, включение котлов по в заданном порядке, в зависимости от температуры обратки (если температура ниже расчетной то запускается второй котел и так далее). В этом методе управления, могут выступать дополнительные косвенные факторы (температура на улице, температура в помещениях, температура (подачи, обратки, расход теплоносителя) и количество активированных котлов, импульсный счетчик тепла )
- Резервирование, включение в замен основного котла/котлов резервного, при достижении определенных условий, релейным и/или электронным способом.

### Циркуляционный насос

Входит в состав прямого или смесительного контура.

Входит в состав электрического котла, возможно сторонне управление насосом электрического котла если невозможно использовать релейно-электронный способ.

Входит в состав схемы управления твердотопливным котлом.

#### Управление циркуляционным насосом

- Релейное, через вкл/выкл питания, тут тоже может быть переменный расход, но насос терпит работу на закрытую задвижку, так как мощность насоса маленькая.
- Частотный преобразователь, только для больших насосов, с переменным расходом.

### Прямой или смесительный контур

- Группа радиаторов (смесительный)
- Группа труб теплого пола (смесительный)
- Бойлер косвенного нагрева (прямой)
- Калорифер вентиляции (смесительный)
- Бассейн (прямой со стороны котла) + (прямой со стороны бассейна)
- Тепловой аккумулятор (прямой)
- Солнечный коллектор (прямой со стороны котла) + (прямой со стороны солнечного коллектора)
  - Источник тепла
- И так далее ...

#### Управление контуром

- Аналоговое, через подачу от 0 до 10 вольт на устройство, что соответствует проценту между крайними положениями.
- Механическое, через трехходовой термостатический клапан.
- Механическое, через фиксированное положение трехходового крана.

### Отопительный прибор

- Один радиатор (управление на радиаторе или на коллекторе)
- Одна труба теплого пола или стены (управление на коллекторе)
- Одна труба снеготаяния (управление на коллекторе)
- Фанкойл (тепловая завеса, калорифер с вентилятором)
- Водяной конвектор встроенный в пол с вентилятором или без
- И так далее ...

#### Управление отопительным прибором

- Механическое, через фиксированное положение крана
- Электромеханическое, через термостатический сервопривод
- Аналоговое, через подачу от 0 до 10 вольт на сервопривод (термостатический или другого исполнения), что соответствует проценту между крайними положениями
- Релейное, через подачу питания (на вентилятор, клемму термостата)

### Подпитка

Система отслеживающая давление в системе отопления для:

- Уведомлении о падении давления
- Подпитка в автоматическом режиме
- Мониторинг за давлением

## Автоматизация

### Обзор

В системах отопления как правило присутствуют действующие акторы в виде приборов запрашивающих тепло, генерирующих тепло и доставляющих тепло в нужном объеме.

В совсем простых системах, могут присутствовать только запрашивающие и генерирующие тепло устройства, и как правило это системы где тепло передается в виде электричества.

Запрашивают тепло как правило приборы, потребляющие тепло для каких либо нужд, нагрев воздуха по средством радиаторов, нагрев поверхностей за счет труб (теплого пола, снеготаяния), приготовление горячей воды, нагрев бассейна, подогрев воздуха в вентиляционной установке.

В системах где тепло передается не по средством электричества, применяется некая среда (гликоль, вода, другие жидкости) которая перемещает тепло из одного места в другое, и устройства помогающие перемещать саму среду (насосы), а так же присутствуют устройства, которые дозируют потребление тепла (смесительные узлы) которые ограничивают передачу тепла от генератора к каждому потребителю путем подмешивания более горячего носителя в контур с остывшим носителем.

Производят тепло, устройства генерации тепла, они бывают разных видов и устройств, но единственная их задача это нагревать среду которая постоянно перемещается по средством насосов по всей сети отопления.

### Термостат

В нашем случае имеется в виду термостат который реализован по средством компьютерной программы, и имеет не только функциональность вкл/выкл.

С точки зрения автоматики, термостат состоит из:

#### Входящие аргументы

- Тип регулирования
  - Гистерезис
    - Для высоко инерционных систем
    - Для систем где генератор тепла/холода не имеет достаточной гибкости по регулировки мощности, либо она отсутствует полностью
  - ПИД
    - Для менее инерционных систем
    - Для систем где генератор тепла/холода имеют достаточно гибкую регулировку мощности

- Тип нагреваемой/охлаждаемой среды
  - Вода в бойлере
  - Воздуха в доме
    - Доступно охлаждение только этой среды
  - Поверхность пола
  - Поверхность стены
  - Поверхность дорожки на улице
  - Воды в бассейне
  - Помогает выбрать min/max температуру на подающей линии
  - Если выбрана нагреваемая среда, то при редактировании min/max температуры будет появляться окно подтверждения с предупреждением
  - Если выбрано устройство, для него может быть реализована специальная логика по мимо общей

- Минимальное значение запроса температуры подающей линии
  - Для теплого пола 30
  - Для радиатора 30
  - Для дорожки на улице 55
  - Для бойлера 60
  - Для панели охлаждения 7
  - Для кондиционера 18
  - Ниже это температуры нельзя будет запросить
  - Безусловный нижний предел это 5
- Максимальное значение запроса температуры подающей линии
  - Для теплого пола 50
  - Для радиатора 75
  - Для снеготаяния 75
  - Для бойлера 75
  - Для панели охлаждения 20
  - Для кондиционера 30
  - Выше этой температуры будет невозможно запросить
  - Без условный верхний предел 75

- Минимальный запрос температуры подачи, между min и max значением, по умолчанию 25%
  - Можно задать в диапазоне от 100% до 25%
  - При значении 100%, ограничение по температуре отключается, и запрос температуры подающей линии всегда имеет максимальное значение
  - Не учитывается при охлаждении
- Минимальный расход в приборе, по умолчанию 25%
  - Можно задать в диапазоне от 100% до 25%
  - При значении 100%, ограничение по расходу отключается, и расход всегда 100%
  - Не учитывается при охлаждении

- Уставка/Требуемая/Целевая температура нагреваемой/охлаждаемой среды
  - Уставка задается как объект
    - Условие, температура воздуха на улице ( > 25, <= 25 && > 20, <= 20 && > 10, <= 10 && > 5, <= 5 && > -5, <= -5 && > -10, <= -10 && > -15, <= -15 && > -20, <= -20 && > -30, <= -30 )
    - Температура нагреваемой/охлаждаемой среды, задается для каждого диапазона уличной температуры
    - Тип поведения (нагрев/охлаждение), задается, задается для каждого диапазона уличной температуры
  - Воды в бойлере
  - Воздуха в доме
  - Поверхность пола
  - Поверхность стены
  - Поверхность дорожки на улице
  - Воды в бассейне
  - И других сред которые можно нагревать до желаемой пользователем температуры
  - При достижении уставки, начинается пропорциональное уменьшение температуры подающей линии и расхода

- Уставка температуры начала пропорционального уменьшения
  - Температура после которой начнет происходить пропорциональное уменьшение запроса тепла
  - Не учитывается при охлаждении

- Левая часть гистерезиса
  - Не более -5 единиц, от уставки
  - Значение после которого включается запрос тепла
    - При охлаждении это переворачивается и становится температурой при которой ВЫКлючается охлаждение
  - Для бойлера значение может быть -25 единиц, от уставки
- Правая часть гистерезиса
  - Не более +5 единиц, от уставки
  - Значение после которого выключается запрос тепла
    - При охлаждении это переворачивается и становится температурой при которой ВКлючается охлаждение

- Датчики температуры нагреваемой/охлаждаемой среды
  - Тип контрола value
  - В реальности это либо проводной, либо без проводной датчик температуры
- Правила для вычисления температуры нагреваемой/охлаждаемой среды
  - MAX максимальную, MIN минимальную, AVG среднюю, по умолчанию AVG

- Запросы на перемещение теплоносителя
  - Тип контрола switch
  - Если нет ни одного запроса на тепло, то все сервоприводы, переводятся в нормальное положение

#### Логика работы

##### Нагрев

Расстояние между min и max значением запроса тепла, это 100%.

Если значение ниже левого гистерезиса, то выставляется 100% запроса тепла.

Когда достигается пороговая температура начинается пропорциональное снижение запроса тепла плоть до нуля при достижении правого гистерезиса.

Если достигнута температура правого гистерезиса, запрос тепла становится 0%, нагрев заканчивается.

В случае если насосы питающие петли за которые отвечает термостат выключены, то можно перевести все приводы в нормальное положение, в случае систем отопления нормально открытое положение.

###### Возможно ли тут применить ПИД регулирование ?

Если генератор тепла способен плавно регулировать свою мощность от 0 до 100% своих характеристик, то в таком случае возможно применить ПИД регулирование.

Если установлена буферная емкость мощностью в 5-10 раз больше минимальной мощности потери тепла, то в таком случае возможно применить ПИД регулирование.

Если минимальные потери тепла выше минимальной регулировки генератора тепла, то в таком случае возможно применить ПИД регулирование.

В остальных случаях удобно использовать управление по схеме термостата с гистерезисом, так как инертную систему удобно использовать как тепло аккумулятор, чтобы избегать тактование генератора тепла.

###### Вариант ПИД регулирования

##### Охлаждение

Мы рассматриваем случай охлаждения только воздуха и только кондиционером, так как экзотические варианты в виде панелей охлаждения слишком редкие.

Для кондиционера, нужно сделать ВКЛ/ВЫКЛ.

Задать требуемую температуру воздуха, далее кондиционер уже сам.

#### Исходящие аргументы

- "Термостат включен" (на тепло)
  - Подставляется в макрос генератор тепла
    - Тип контрола switch
    - Логическое значение
  - Подставляется в макрос транспортировки теплоносителя
    - Тип контрола switch
    - Логическое значение

- "Термостат включен" (на холод)
  - Подставляется в макрос генератор холода
    - Тип контрола switch
    - Логическое значение

- Температура подающей линии (на тепло)
  - Подставляется в макрос генератор тепла
    - Тип контрола value
    - Целое число
    - Градусы цельсия
  - Подставляется в макрос смеситель
    - Тип контрола value
    - Целое число
    - Градусы цельсия

- Температура кондиционера (на холод)
  - Подставляется в макрос генератор холода
    - Тип контрола value
    - Целое число
    - Градусы цельсия

- Расход теплоносителя, числовое значение от 0 до 100%
  - Подставляется в макрос управляющий соответствующими термостатическими сервоприводами
    - Тип контрола value, целое число
    - При охлаждении всегда null

### Термостатические сервоприводы

С точки зрения автоматики, управление термостатическими сервоприводами состоит из:

#### Входящие аргументы

- Требуемый расход теплоносителя, числовое значение от 0 до 100%
  - Если получено null, то привод отключается и переходит в нормальное состояние.
- Частота подогрева в миллисекундах, при 50% расхода теплоносителя
  - Временное расстояние между включениями и отключением реле
  - Время в отключенном состоянии соответствует времени во включенном состоянии
  - Регулярное включение и отключение реле, позволяет удерживать положение привода на требуемой высоте
  - Значение задается при 50%, так как от этой точки проще всего достроить значение тактов слева и справа

#### Логика работы

Если значение 0% то реле всегда отключено и сервопривод находится в нормальном положении.

Если значение 100% то реле всегда включено и сервопривод находит на противоположном нормальному состоянию.

Если значение между 0 и 100%, реле периодически включается и выключается, подогревая парафин внутри сервопривода, что позволяет удерживать положение привода на соответствующем уровне относительно значения в процентах.

#### Исходящие аргументы

- Состояние реле
  - Тип контрола switch
  - Логическое значение

### Смеситель

С точки зрения автоматики, смеситель состоит из:

#### Входящие аргументы

- Текущая температура подачи (tCurrent)
  - Берется из датчика температуры установленного после смесителя и насоса на подающей линии
- Требуемые/Уставки температуры подачи (temperature)
  - Берутся из "Термостатов"/Запросов тепла
  - Правило выбора температуры из преложенных вариантов
    - MAX максимальную
    - MIN минимальную
    - AVG среднюю
    - По умолчанию MAX
- Минимальная значение температуры подачи (tMin)
  - По умолчанию 40
  - Устанавливается при пуска-наладке
- Максимальное значение температуры подачи (tMax)
  - По умолчанию 45
  - Устанавливается при пуска-наладке
- Такты вычислениями ошибки в микро секундах
  - По умолчанию 30 * 1000 ms
  - Устанавливается при пуска-наладке
- Коэффициент пропорционального регулирования (kP)
  - По умолчанию 1
  - Подбирается при пуска-наладке
- Коэффициент интегрального регулирования (kI)
  - По умолчанию 0.25
  - Подбирается при пуска-наладке
- Коэффициент дифференциального регулирования (kD)
  - По умолчанию 0.5
  - Подбирается при пуска-наладке
- Минимальная значение ошибки (eMin)
  - По умолчанию 0
  - Устанавливается по проекту
- Максимальное значение ошибки (eMax)
  - По умолчанию (Минимальная значение температуры подачи - Минимальная значение температуры подачи)
  - Устанавливается по проекту
- Минимальный физический управляющий сигнал (oMin)
  - По умолчанию 0
  - Значение зависит от фактически используемых устройств, или говоря абстрактно, от потребителя этого параметра.
- Максимальное физический управляющий сигнал (oMax)
  - По умолчанию 10000
  - Значение зависит от фактически используемых устройств, или говоря абстрактно, от потребителя этого параметра.

#### Логика работы

Общий смысл регулирования достаточной простой и заключается в:
  1. Вычислении ошибки
  2. Вычислении величины управляющего сигнала, по формуле ПИД регулирования
  3. Связи управляющего сигнал со значением физической величины
  4. Передача полученной физической величины исполнительному устройству
  5. Устройство меняет физическое поведение системы
  6. Происходит ожидание следующего такта, в это время меняются параметры инертной физической среды
  7. Наступает следующий такт, и все начинается с пункта 1

##### Вычисление ошибки и управляющего сигнала

Ошибка это разница между уставкой и измеренным значением.

Управляющий сигнал вычисляется по средством сложения трех составляющих пропорциональной, интегральной, дифференциальной.

Настройка влияния того или иного фактора происходит через коэффициенты, чем он коэффициент больше чем влияние сильнее.

###### Пропорциональный компонент

Это значение ошибки умноженное на коэффициент пропорционального регулирования.

###### Интегральный компонент

Это сумма значений ошибки за все предыдущие такты умноженная на коэффициент интегрального регулирования.

Позволяет обострить небольшую ошибку, чтобы достичь точного значения в нашем случае температуры.

Либо ускорить регулирование, если величина ошибки большая.

Нужно быть внимательным, и если регулировка ушла в крайнее значение, переставать суммировать в интегральной составляющей, так как если значение ошибки перевернется в другую сторону то придется долго ждать пока не проссумируется отрицательная (или положительная) ошибка, явление известное как интегральный "перегон".

###### Дифференциальный компонент

Это разница между текущем значением ошибки и значением ошибки на прошлом такте, деленная на продолжительность такта.

Показывает скорость изменения ошибки.

##### Линейная связь управляющего сигнала и поворота крана

Для связи управляющего сигнала и физического сигнала, используется формула где:

eMin - Минимальное значение ошибки

eMax - Максимальное значение ошибки

oMin - 0 - Минимальный физический управляющий сигнал

oMax - 10000 - Максимальный физический управляющий сигнал

oMin и oMax - конкретное значение на текущем оборудовании, в идеале должно вводиться через настройки.

error - это результат который возвращает ПИД регулятор.

Формула в общем виде: oMin + ((error - eMin)/(eMax - eMin)) * (oMax - oMin).

Если oMin = 0, формула сокращается до: oMax * ((error - eMin)/(eMax - eMin)).

В случае если oMin и oMax вводятся в настройках, нужно использовать общий вид формулы.

Пример, уставка 40, температура подачи 43, eMin = 0, eMax = 5. oMin = 0, oMax = 10000, физический сингал = 10000 ((3 - 0) / (5 - 0)) = 10000 * (3 / 5) = 6000 (в нашем случае, кран прикроется на 60%, от 0% положения).

Пример, уставка 40, температура подачи 38, eMin = 0, eMax = 5. oMin = 0, oMax = 10000, физический сингал = 10000 ((-2 - 0) / (5 - 0)) = 10000 * (-2 / 5) = -4000 (в нашем случае, кран прикроется до положения 0%, из того положения в котором он был ранее).

Таким образом, можно связывать любые величины с ошибкой линейным способом.

#### Исходящие аргументы

- Положение смесительного крана (0-10 Вольт, что в реальности числовые значения от 0 до 10000)
  - Тип контрола value
  - Эти значения зависят от используемого оборудования

### Транспортировка теплоносителя

С точки зрения автоматики, транспортировка теплоносителя состоит из:

#### Входящие аргументы

- Запросы на перемещение теплоносителя
  - Сюда подставляется логическое значение '"Термостат включен" или запрошено тепло' из макроса термостата
  - Тип контрола switch, логическое значение,
  - Принимает список из нескольких контролов

- Выбег насоса
  - Тип контрола value, в минутах
  - Время которое насос будет активен, после пропадания запроса на перемещение теплоносителя

- Периодическое включение
  - Список из настроек
    - температура на улице в градусах цельсия (value)
    - периодичность включения в минутах (value)
    - время работы в минутах (value)
  - Это нужно, чтобы:
    - Не закисал вал в летний период
    - Чтобы уменьшить риск замораживания участков сети отопления, в зимней период

#### Логика работы

Запрос на перемещение теплоносителя, возникает в момент когда какой либо термостат связанные с текущей насосной группой включился.

При появлении запроса на перемещение теплоносителя активируется питание насоса по средством реле.

После пропадания запроса, насос продолжает работать в течении времени выбега.

Если заданы периодические включения, то наступление условий включения, приравниваются к запросу на перемещение теплоносителя.

#### Исходящие аргументы

- Состояние реле
  - Тип контрола switch
  - Логическое значение

### Генерация тепла

С точки зрения автоматики, генерация тепла состоит из:

#### Входящие аргументы

#### Логика работы

#### Исходящие аргументы

### Подпитка

С точки зрения автоматики, подпитка состоит из:

#### Входящие аргументы

#### Логика работы

#### Исходящие аргументы
